import subprocess
import pyperclip

def scan_ip(ip):
    command = f"nmap -sS -T5 -p- --min-rate=5000 -Pn -n {ip}"
    try:
        output = subprocess.check_output(command, shell=True, stderr=subprocess.STDOUT)
        open_ports = [line.split('/')[0] for line in output.decode().splitlines() if "/tcp" in line and "open" in line]
        open_ports_str = ",".join(open_ports)
        print("Puertos abiertos:", open_ports_str)
        pyperclip.copy(open_ports_str)  # Copia al portapapeles
        print("Puertos copiados al portapapeles.")

        # Escaneo de versión y detección de scripts para todos los puertos abiertos
        version_script_scan_command = f"nmap -sC -sV -p {','.join(open_ports)} {ip}"
        version_script_scan_output = subprocess.check_output(version_script_scan_command, shell=True, stderr=subprocess.STDOUT)
        print("Escaneo de versión y detección de scripts para todos los puertos abiertos:")
        print(version_script_scan_output.decode())
        
    except subprocess.CalledProcessError as e:
        print(f"Error: {e.output.decode()}")

ip = input("Ingrese la dirección IP a escanear: ")
scan_ip(ip)
